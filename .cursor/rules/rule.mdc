---
alwaysApply: true
---
# Cursor Rule – 카페매니저 (네이버 카페 자동 포스팅 & 게시글 관리 솔루션)

이 `rule.md`는 **카페매니저** 프로젝트에서 Cursor AI가 코드를 생성할 때 반드시 따라야 할 공통 규칙과 컨텍스트를 정의합니다.  
프롬프트마다 따로 설명하지 않고, 이 문서를 기준으로 일관성 있게 개발합니다.

---

## 1. 프로젝트 개요 (Project Overview)

- 프로젝트명: **카페매니저 – 네이버 카페 자동 포스팅 & 게시글 관리 솔루션**
- 형태: **웹 기반 SaaS**
- 주요 타깃:
  - 중고폰 / 중고 IT 기기 도·소매 사업자
  - 네이버 카페(중고나라 등)를 주요 판로로 사용하는 온라인 셀러, 리셀러
- 핵심 제공 가치:
  - 네이버 카페 **자동 글쓰기**, **스케줄 기반 반복 포스팅**
  - **“내가 쓴 글” 목록 동기화**
  - 카페/게시판별 **게시글 개수 자동 유지(강제 N개 유지)** 및 **자동 삭제**
  - 운영 로그 및 대시보드

---

## 2. 비즈니스 목표 (Business Goal)

1. **운영 자동화**
   - 사장님이 매일 반복하는 네이버 카페 게시/삭제/정리 작업을 자동화하여 운영 시간을 줄인다.
2. **노출 & 신뢰도 향상**
   - 최신/유효 매물 위주의 게시판 유지 → 문의 및 전환율 향상.
3. **구독 모델 구축**
   - 1개월 / 1년 **기간제 라이선스**를 통해 안정적인 반복 매출(MRR)을 확보한다.

---

## 3. 기능 범위 (Feature Scope)

### 3.1 1단계 – MVP (***최우선 구현 범위***)

Cursor가 **기본적으로 구현 대상으로 삼아야 하는 범위**입니다.

1. **네이버 로그인 및 계정 관리**
   - 서비스 계정(우리 서비스) 로그인
   - 네이버 계정 연동/세션 관리용 엔드포인트 및 DB 구조 설계
   - Playwright가 재사용할 수 있는 네이버 세션/프로필 경로 저장

2. **템플릿 기반 즉시 글쓰기**
   - 카페/게시판별 템플릿 엔티티: 제목 템플릿, 본문 템플릿 등
   - 템플릿 + 입력 데이터로 실제 게시글 내용을 생성하는 로직
   - “지금 게시하기” API 및 프론트엔드 UI

3. **네이버 카페/게시판 기준 스케줄 포스팅**
   - 스케줄 엔티티 (cron-like 표현 또는 단순 주기)
   - 하루 최대 포스팅 수 제한 필드 포함
   - 스케줄 생성/수정/삭제 API 및 UI
   - 백그라운드 Job이 스케줄에 따라 게시 작업을 큐에 넣는 구조

4. **“내가 쓴 글” 목록 동기화**
   - Playwright 워커가 정기적으로 “내가 쓴 글” 페이지를 크롤링
   - 제목/URL/작성일을 `managed_posts` 테이블에 동기화
   - 프론트에서 리스트 조회 가능하게 구현

5. **기본 로그 및 대시보드**
   - Job 단위 실행 로그 (성공/실패/시간/에러메시지)
   - 최근 포스팅/동기화 내역 조회용 간단한 대시보드

6. **Job 기반 안정적인 Playwright 워커 구조**
   - Redis + BullMQ(또는 유사한 Job 큐)를 사용하여 Job 관리
   - 워커 프로세스에서 Job 타입별 처리 함수 (`SYNC_POSTS`, `CREATE_POST` 등) 구조화
   - 에러 시 재시도/스크린샷 저장 등 확장 가능한 형태로 설계

> ⚠️ 1단계에서는 **결제/라이선스 만료 처리, 강제 N개 유지, 자동 삭제**는 설계만 하고 실제 기능은 2·3단계에서 구현해도 된다.  
> 단, DB 스키마는 이후 확장을 고려하여 설계하되, 과도하게 복잡하게 만들지 말 것.

---

### 3.2 2단계 – 운영 자동화 고도화 (Later, but planned)

이 기능들은 **나중에 구현**하되, 1단계 설계 시 확장을 염두에 둔다.

1. **카페·게시판별 “강제 N개 유지” 정책**
   - `post_rules` 또는 유사 테이블에 rule_type=`MAX_COUNT`, value=`N` 형태로 저장
   - 동기화된 `managed_posts`를 기준으로 삭제 후보 선정 로직 설계

2. **자동 삭제 기능**
   - 삭제 대상 리스트 → `DELETE_POST` Job 생성
   - Playwright 워커에서 실질 삭제 수행
   - 삭제 로그 (삭제 전/후 상태, 정책 ID 등) 기록


> Cursor는 2단계 기능을 구현할 때, 기존 구조(스키마, Job 큐, 워커 구조)를 **재활용**하고,  
> 불필요한 중복 코드/엔티티 생성은 피한다.

---

### 3.3 3단계 – 데이터·비즈니스 확장 (Later)

1. **1개월 / 1년 기간제 결제 및 만료 체크**
   - `users` 또는 `subscriptions` 테이블에 `plan_type`, `expire_at` 필드 추가
   - 모든 중요 API/Job 실행 전에 라이선스 유효성 체크 미들웨어/가드 추가
   - 만료 전 알림(단, 실제 알림발송 로직은 나중에 추가해도 됨)

2. **운영 통계·리포트 고도화**
   - 일/주/월 단위 포스팅 수, 삭제 수, 성공률, 카페별 효율 등의 통계용 쿼리/뷰 설계
   - 관리자/사용자용 대시보드 확장

--

## 5. 개발 가이드 (Dev Guidelines)

### 5.1 공통 원칙

1. **비즈니스 로직과 UI/자동화 로직 분리**
   - 삭제/포스팅 대상 선정 로직은 **서버/DB 쿼리**에서 결정
   - Playwright 워커는 “무엇을 할지”가 아니라 “지시된 작업을 수행”하는 역할로 설계

2. **확장 가능한 설계**
   - 1단계에서 만든 스키마/구조가 2·3단계에서 재사용 가능하도록 설계

3. **안정성 & 로깅**
   - 모든 Job에는 최소한 `status`, `error_message`, `started_at`, `finished_at`을 기록
   - Playwright 작업 실패 시 스크린샷/HTML 스냅샷을 남길 수 있는 훅/구조를 마련

### 5.2 금지/주의 사항

- **게시글 수정(EDIT)** 기능:
  - 명시적으로 요청되기 전까지 구현하지 말 것.
  - 데이터 스키마에 `last_modified_at` 등 필드를 넣는 것은 허용되지만, 실제 수정 로직은 제외.

- **과도한 네이버 API/내부 호출 가정 금지**
  - 공식 카페 API는 “가입/글쓰기” 수준임을 가정하고, 삭제/수정/목록 등은 **웹 화면 기반 자동화**로 처리해야 함.

- **하드코딩된 민감 정보**
  - API 키, 비밀번호, 토큰 등은 `.env` 기반으로 처리하고 코드에 직접 노출하지 않는다.

### 5.3 코드 스타일

- 언어: TypeScript 우선
- 네이밍:
  - PascalCase: 클래스/타입
  - camelCase: 변수/함수
  - SNAKE_CASE: 환경변수
- 함수는 하나의 책임(Single Responsibility)에 집중하고, 50~80줄 내외로 유지하도록 노력
- 하나의 소스는 500줄 내외로 유지하도록 노력